<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Product Manager - Demo</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module" src="app.js"></script>
</head>
<body>
  <div class="container">
    <h1>Product Manager - Crud Operation API</h1>

    <section>
      <h2>Sign Up</h2>
      <form id="signupForm">
        <input name="firstName" placeholder="First name" required />
        <input name="lastName" placeholder="Last name" />
        <input name="email" placeholder="Email" type="email" required />
        <input name="password" placeholder="Password" type="password" required />
        <button type="submit">Sign Up</button>
      </form>
    </section>

    <section>
      <h2>Login</h2>
      <form id="loginForm">
        <input name="email" placeholder="Email" type="email" required />
        <input name="password" placeholder="Password" type="password" required />
        <button type="submit">Login</button>
      </form>
    </section>

    <section>
      <h2>Create Product</h2>
      <form id="productForm">
        <input name="name" placeholder="Product name" required />
        <input name="price" placeholder="Price" type="number" />
        <input name="category" placeholder="Category" />
        <input name="description" placeholder="Description" />
        <button type="submit">Create</button>
      </form>
    </section>

    <section>
      <h2>Products</h2>
      <button id="fetchProducts">Fetch Products</button>
      <ul id="productsList"></ul>
    </section>
  </div>

<script>
const api = (path, opts = {}) => fetch(path, { credentials: 'include', headers: { 'Content-Type': 'application/json' }, ...opts });

document.getElementById('signupForm').addEventListener('submit', async e => {
  e.preventDefault();
  const form = Object.fromEntries(new FormData(e.target).entries());
  const res = await api('/api/auth/signup', { method: 'POST', body: JSON.stringify(form) });
  alert((await res.json()).message || res.statusText);
});

document.getElementById('loginForm').addEventListener('submit', async e => {
  e.preventDefault();
  const form = Object.fromEntries(new FormData(e.target).entries());
  const res = await api('/api/auth/login', { method: 'POST', body: JSON.stringify(form) });
  const json = await res.json();
  alert(json.message || res.statusText);
});

document.getElementById('productForm').addEventListener('submit', async e => {
  e.preventDefault();
  const form = Object.fromEntries(new FormData(e.target).entries());
  if (form.price) form.price = Number(form.price);
  const res = await api('/api/products', { method: 'POST', body: JSON.stringify(form) });
  const json = await res.json();
  alert(json.message || res.statusText);
});

document.getElementById('fetchProducts').addEventListener('click', async () => {
  const res = await api('/api/products', { method: 'GET' });
  const json = await res.json();
  const ul = document.getElementById('productsList');
  ul.innerHTML = '';
  (json.products || []).forEach(p => {
    const li = document.createElement('li');
    li.textContent = `${p.name} — ${p.price} — by ${p.createdBy?.firstName || 'unknown'}`;
    ul.appendChild(li);
  });
});
</script>
</body>
</html>
